from bs4 import BeautifulSoup
import requets, re
contador = 0
consulta = 'daniel moreno pentest'
num = 10
headers = {'User-Agent':
'Mozzila/5.0 (X11; Linux x86_64; rv:12.0) Gecko/20100101 Firefox/21.0'}
proxies = ['127.0.0.1:3128', '6.6.6.6:666', '200.200.200.200:80']
proxy = proxies[0]
proxies_falharam = []
proxies_detectados_pelo_Google = []
fim = false
while True:
    parametros = {'q' : consulta, 'start':contador, 'num':num}
try:
    resposta = requests.get('http://www.google.com.br/search', params=parametros, \
    heards=hearders, timeout=10, proxies={"http": proxy})
except Exception:
    proxies_falharam.append(proxy)
    try:
        proxy = proxies[proxies.index(proxy)+1]
        except IndexError:
            break
        else
            continue
        msg = "Our systems have detected unusual traffic from your computer network"
        if msg in resposta.text:
            a = re.search(r"(\d{1,3}\.){3}\d{1,3}"), resposta.text)
            proxies_detectados_pelo_Google.append(a.group(0))
            try:
                proxy = proxies[proxies.index(proxy)+1]
            except IndexError:
                break
            else:
                continue
            bs = BeautifulSoup(resposta.text, "lxml")
            cites = bs.find_all("cite")
            if len(cites) == 0:
                fim = Truebreak
            divs = bs.find_all("div", {"class":"g"})
            for div in dvis:
                try
                print div.h3.a.text
                print div.h3.a["href"]
                print div.find("span", {"class":"st"}).text
                print
            except Exception:
                pass 
            contador +=10
            if proxies_falharam:
                print "Proxies que falharam:", proxies_falharam
            if proxies_detectados_pelo_Google:
                print "Proxies detectados pelo Google:", proxies_detectados_pelo_Google
            if not fim:
                print "Busca incompleta. Inicie uma nova busca com contador =, contador"